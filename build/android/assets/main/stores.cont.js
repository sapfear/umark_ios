function onInitController(e,t){if("iphone"==Ti.Platform.osname)var r=require("TiTools2/TiTools");else var r=require("TiTools2_a/TiTools");cmp=r.Component,win=e,request=r.TxRx,clicked=!1,Ti.Network.online||(offline=!0)}function onWindowOpen(e,t){form=t2.Form.load(e,"main/stores.form.js",{});var r=Titanium.UI.iOS.createTabbedBar({labels:["Списком","На карте"],backgroundColor:"#0c8ccd",top:10,height:25,width:"100%",index:0});r.addEventListener("click",function(e){0==e.index&&showByDistance(),1==e.index&&showOnMap()}),form.me.add(r),distView=Ti.UI.createScrollView({width:Ti.UI.FILL,height:Ti.UI.FILL,layout:"vertical"}),formsContainer=Ti.UI.createScrollableView({scrollingEnabled:!1,height:Ti.UI.FILL,bottom:10,top:10}),form.me.add(formsContainer);var n=!1;t2.Geo.currentPosition({success:function(e){n||(showStores(e),n=!0)},failure:function(){n||(showStores(!1),n=!0)}})}function createMapView(e,t){var r=require("main/map.cont");return mapView=new r(win,t),mapView.setLocation({latitude:e.latitude,longitude:e.longitude,animate:!0,latitudeDelta:10,longitudeDelta:10}),mapView}function showStores(e){Ti.API.info("stores start "),t2.Utils.info(e),request.getStoresList(function(t){var r=t;_.isEmpty(r)||_.each(r,function(t,r){var n="";e&&t.location&&t.location.lon&&t.location.lat&&(n=+t2.Geo.distance({longitude:t.location.lat,latitude:t.location.lon},e),n=(n/1e3).toFixed(1),n+=" км.");var i=t2.Form.load(void 0,"templates/list/store.form.js",{title:t.contacts.city.substring(0,n?22:35),dist:n,rightOffset:n?80:0}),o=i.me,a={preset:"Window",style:{title:t.contacts.city.substring(0,20)},args:{title:t.name,location:t.location,contacts:t.contacts,id:t.id}};o.addEventListener("click",function(){if(!clicked){clicked=!0;var e=t2.Project.createWindow("store",a);t2.UI.currentTab.open(e)}_.delay(function(){clicked=!1},1e3)}),distView.add(o),t2.Form.load(distView,{prefab:"List.Separator"})}),e?formsContainer.views=[distView,createMapView(e,r)]:formsContainer.views=[distView,createMapView({longitude:"55.16089",latitude:"61.492655"},r)]})}function onWindowClose(e,t){}function showByDistance(){formsContainer.scrollToView(0),mapView&&(mapView.userLocation=!1)}function showOnMap(){2===formsContainer.views.length&&(formsContainer.scrollToView(1),mapView.userLocation=!0)}var t2,bank,cmp,win_main,form,mod,request,formsContainer,distView,mapLocation,clicked;module.exports={onInitController:onInitController,onWindowOpen:onWindowOpen,onWindowClose:onWindowClose};