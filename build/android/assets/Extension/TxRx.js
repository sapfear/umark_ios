function request(t,e,i,o,n,r,a){if(!Ti.Network.online)return{run:function(){t2.Component.createAlertDialog(void 0,"Error_NetworkOffline").show(),n()}};var s,c,u,l,d,f,g,h,v=!0,r=r||{};s=!!r.rootUrl,c=!!r.loging,h=!!r.notDecode,c=!0,u=r.queue,l=void 0===r.contentType?"application/x-www-form-urlencoded":r.contentType,void 0!==r.loading&&(v=!!r.loading),d=void 0!==r.post?r.post:void 0,f=void 0!==r.put?r.put:void 0,g=void 0!==r.timeout?r.timeout:3e4;var T={Accept:"application/json","Content-Type":l};t2.Global.get("user")&&(T["Auth-Token"]=t2.Global.get("user").token);var p=s?t2.Global.get("rootUrl"):t2.Global.get("url");void 0!==a&&(p=a);var m=t2.Network.createClientHttp({queue:u,options:{method:t,url:p+e,headers:T,args:i,post:d,put:f,timeout:g,notDecode:h},loading:function(){v&&indicator.show()},loaded:function(){v&&indicator.hide()},success:function(n){var r=t2.JSON.deserialize(n.response("text"));c&&(Ti.API.info("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),Ti.API.info("BANK SUCCESS: "+t+" "+p+e),_.isEmpty(i)||(Ti.API.info("params"),t2.Utils.info(i)),void 0!==d&&(Ti.API.info("post"),t2.Utils.info(d)),void 0!==f&&(Ti.API.info("put"),t2.Utils.info(f)),Ti.API.info("result"),t2.Utils.info(r),Ti.API.info("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")),o(r,n)},failure:function(a){if(void 0===a.status)return void t2.Component.createAlertDialog(void 0,"Error_NetworkOffline").show();if(c&&(Ti.API.info("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),Ti.API.info("BANK FAILURE: "+t+" "+p+e),Ti.API.info("status "+a.status()),_.isEmpty(i)||(Ti.API.info("params"),t2.Utils.info(i)),void 0!==d&&(Ti.API.info("post"),t2.Utils.info(d)),void 0!==f&&(Ti.API.info("put"),t2.Utils.info(f)),Ti.API.info("response"),t2.Utils.info(a.response("text")),Ti.API.info("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")),403!==a.status()){try{var s=t2.JSON.deserialize(a.response("text"))}catch(t){}var u=n(a,s);s&&void 0!==s.restrict_message?(_.isArray(s.restrict_message)&&!_.isEmpty(s.restrict_message)&&cmp.createAlertDialog(void 0,_.first(s.restrict_message)).show(),_.isString(s.restrict_message)&&cmp.createAlertDialog(void 0,s.restrict_message).show()):_.isString(u)&&cmp.createAlertDialog(void 0,u).show()}else{var l,g=request(t,e,i,o,n,r);if(authQuery.push(g),1==authQuery.length){var h=t2.Project.createWindow("login",{preset:"Window",style:{titleid:"EntranceToBank"},args:{onSuccessCallback:function(){authQuery.length>0&&_.each(authQuery,function(t,e){Ti.API.info(e),t.run(0)}),authQuery=[]},closeCallback:function(){l.close()}}});l=Ti.UI.iOS.createNavigationWindow({modal:!0,window:h}),l.open()}}}});return m}function blankFailure(t){return t2.tr("Error_Common")}function getBrands(t,e){function i(i){t2.Utils.info(t),_.each(i,function(i,o){i.location&&i.location.lon&&i.location.lat&&i.location.lon+""+i.location.lat==t&&(t2.Utils.info(i.location.lon+""+i.location.lat),e(i.brands))})}request("GET","stores/",{},i,function(){},{}).run()}function getStoresList(t){request("GET","stores/",{},t,function(){},{}).run()}function getElements(t,e){request("GET","items/?category_id="+t,{},e,function(){},{}).run()}function getElementsInStore(t,e,i){request("GET","category/?category_id="+t+"&store_id="+e,{},i,function(){},{}).run()}function getCategoryiesInStore(t,e){function i(i){_.each(i,function(i,o){i.id&&i.id==t&&e(i.categories)})}request("GET","stores/",{},i,function(){},{}).run()}function getCategoryies(t,e){function i(i){var o=[];_.each(i,function(e,i){e.parrent_id-0==t&&o.push(e)}),e(o)}request("GET","group/",{},i,function(){},{}).run()}function checkVersion(t){request("GET","/assets/mobile_version.json",{},t,function(){},{loading:!1,rootUrl:!0}).run()}function getAnnouncements(t,e){request("GET","announcements/login_page",{},t,e,{loading:!1}).run()}function login(t,e,i,o,n){"function"!=typeof n&&(n=function(t,e){return 401===t.status()||422===t.status()&&void 0!=e.error?e.error:t2.tr("Error_Common")});var r={email:t.toLowerCase(),password:e,confirmation_type:i};request("POST","session",{},o,n,{post:JSON.stringify(r),contentType:"application/json",loging:!1}).run()}if("iphone"==Ti.Platform.osname)var t2=require("TiTools2/TiTools");else var t2=require("TiTools2_a/TiTools");var cmp=t2.Component,_=t2.ThirdParty.underscore,_str=t2.ThirdParty.underscoreString,moment=t2.ThirdParty.moment,indicator=t2.Loading;indicator.init();var authQuery=[];module.exports={request:request,getStoresList:getStoresList,getCategoryies:getCategoryies,getElements:getElements,getBrands:getBrands,getCategoryiesInStore:getCategoryiesInStore,getElementsInStore:getElementsInStore};